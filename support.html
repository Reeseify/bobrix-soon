<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Support — Bobrix</title>
  <meta name="theme-color" content="#0e0f12" />
  <meta name="description" content="Contact Bobrix support." />

  <link rel="icon" href="Boblox%20Icon%20new%20gradientr.png" type="image/png" />
  <link rel="apple-touch-icon" href="Boblox%20Icon%20new%20gradientr.png" />

  <style>
    :root{
      --bg:#0e0f12;
      --panel:#14161b;
      --panel-90:rgba(20,22,27,.9);
      --muted:#8a91a3;
      --text:#e9eefc;
      --text-soft:#cfd7f2;
      --primary:#6aa6ff;
      --ring:rgba(106,166,255,.45);
      --success:#3ddc97;
      --danger:#ff6b6b;
      --border:rgba(255,255,255,.10);
      --shadow:0 20px 60px rgba(0,0,0,.45);
      --radius:18px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial;
      color:var(--text);
      background: var(--bg) center/cover fixed no-repeat;
      background-image:
        radial-gradient(1200px 600px at 80% -10%, rgba(106,166,255,.18), transparent 55%),
        radial-gradient(1000px 600px at -10% 120%, rgba(61,220,151,.14), transparent 55%),
        url("background.png");
    }

    /* Topbar */
    .topbar{
      position:sticky; top:0; z-index:50;
      backdrop-filter: blur(10px);
      background: linear-gradient(180deg, rgba(14,15,18,.85), rgba(14,15,18,.55) 80%, rgba(14,15,18,0));
      border-bottom:1px solid var(--border);
    }
    .nav{
      max-width:1100px; margin:0 auto; padding:14px 18px;
      display:flex; align-items:center; gap:14px;
    }
    .brand{display:flex; align-items:center;}
    .brand img{height:34px; width:auto}
    .navlinks{margin-left:auto; display:flex; align-items:center; gap:12px}
    .link-btn{
      appearance:none; border:1px solid var(--border); background:transparent; color:var(--text-soft);
      padding:8px 12px; border-radius:12px; text-decoration:none; font-weight:600; font-size:14px;
    }
    .link-btn:hover{background:rgba(255,255,255,.06); color:var(--text)}
    .btn{
      appearance:none; border:0; cursor:pointer;
      background: linear-gradient(180deg, #6aa6ff, #4a7fe0);
      color:white; font-weight:800; font-size:14px;
      padding:10px 14px; border-radius:14px; box-shadow:0 10px 24px rgba(74,127,224,.38);
      transition: transform .05s ease, filter .15s ease;
    }
    .btn:hover{ filter:brightness(1.05) }
    .btn:active{ transform: translateY(1px) }
    .btn[disabled]{ opacity:.6; cursor:not-allowed }

    /* Layout */
    .viewport{
      min-height:calc(100vh - 60px);
      display:grid;
      place-items:start center;
      padding:32px 18px 48px;
    }
    .card{
      background:linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,.0)), var(--panel-90);
      border:1px solid var(--border); border-radius:var(--radius);
      box-shadow:var(--shadow); backdrop-filter: blur(12px);
      padding:24px; width:100%; max-width:780px;
    }
    .card h1{ margin:0 0 6px; font-size:26px; font-weight:800 }
    .card p.lead{ margin:0 0 14px; color:var(--text-soft) }

    /* Form */
    form{ display:grid; gap:14px; margin-top:8px }
    .row{ display:grid; gap:14px; grid-template-columns: 1fr 1fr }
    @media (max-width: 700px){ .row{ grid-template-columns: 1fr } }
    .field{ display:grid; gap:8px }
    .label{ font-weight:700; font-size:14px; color:#dae3ff }
    .control{
      display:flex; align-items:center; gap:8px; background:#0f1116;
      border:1px solid var(--border); border-radius:14px; padding:12px 14px;
      transition:border-color .2s, box-shadow .2s;
    }
    .control:focus-within{ border-color:var(--primary); box-shadow:0 0 0 6px var(--ring) }
    .control input, .control select, .control textarea{
      flex:1; background:transparent; border:0; outline:0; color:var(--text); font-size:16px;
    }
    textarea{ min-height:140px; resize:vertical }
    .hint{ font-size:12px; color:var(--muted) }

    .file{ display:flex; align-items:center; gap:10px; flex-wrap:wrap }
    .file input[type="file"]{ display:block }

    .actions{ display:flex; gap:10px; align-items:center; justify-content:flex-end; margin-top:6px }
    .msg{ margin-top:8px; padding:10px 12px; border-radius:12px; font-size:14px; display:none }
    .msg.error{ background:rgba(255,93,93,.18); color:#ffdcdc; display:block }
    .msg.success{ background:rgba(61,220,151,.18); color:#d8ffef; display:block }

    .checkbox{ display:flex; align-items:center; gap:8px; color:var(--text-soft); font-size:14px }
    .checkbox input{ width:16px; height:16px }
  </style>
</head>
<body>
  <!-- Top Navigation -->
  <header class="topbar">
    <nav class="nav">
      <a class="brand" href="/"><img src="BOBRIX%202%20Logo.png" alt="Bobrix Logo" /></a>
      <div class="navlinks">
        <a class="link-btn" href="/">Home</a>
        <a class="link-btn" href="/docs/">Docs</a>
        <a class="link-btn" href="/settings.html">Settings</a>
      </div>
    </nav>
  </header>

  <main class="viewport">
    <section class="card" role="region" aria-labelledby="support-title">
      <h1 id="support-title">Contact Support</h1>
      <p class="lead">Tell us what’s going on and we’ll help you out.</p>

      <form id="supportForm" novalidate>
        <div class="row">
          <div class="field">
            <label class="label" for="username">Username</label>
            <div class="control">
              <input id="username" name="username" type="text" placeholder="Your Bobrix username" required />
            </div>
            <div class="hint">We’ll prefill this if you’re logged in.</div>
          </div>

          <div class="field">
            <label class="label" for="email">Email (optional)</label>
            <div class="control">
              <input id="email" name="email" type="email" placeholder="you@example.com" />
            </div>
            <div class="hint">We’ll reply here if provided.</div>
          </div>
        </div>

        <div class="row">
          <div class="field">
            <label class="label" for="category">Category</label>
            <div class="control">
              <select id="category" name="category" required>
                <option value="">Choose…</option>
                <option>Account</option>
                <option>Technical Issue</option>
                <option>Billing</option>
                <option>Safety</option>
                <option>Abuse Report</option>
                <option>Other</option>
              </select>
            </div>
          </div>

          <div class="field">
            <label class="label" for="subject">Subject</label>
            <div class="control">
              <input id="subject" name="subject" type="text" placeholder="Short summary" minlength="4" maxlength="120" required />
            </div>
          </div>
        </div>

        <div class="field">
          <label class="label" for="details">Describe the issue</label>
          <div class="control" style="padding:0">
            <textarea id="details" name="details" placeholder="What happened? Steps to reproduce? Error messages?" minlength="20" required></textarea>
          </div>
          <div class="hint">Include steps to reproduce, links, and any error messages.</div>
        </div>

        <div class="field">
          <label class="label">Attachment (optional)</label>
          <div class="file control" style="padding:12px 14px">
            <input id="file" name="file" type="file" accept="image/*,video/*,.txt,.log,.json,.zip" />
            <span class="hint">Max ~10MB recommended.</span>
          </div>
        </div>

        <label class="checkbox">
          <input id="consent" type="checkbox" />
          I agree to the <a href="/privacy.html" class="link-btn" style="padding:2px 8px">Privacy</a> and <a href="/terms.html" class="link-btn" style="padding:2px 8px">Terms</a>.
        </label>

        <div class="actions">
          <button class="btn" id="submitBtn" type="submit" disabled>Send to Support</button>
        </div>

        <div id="formMsg" class="msg" role="alert" aria-live="polite"></div>
      </form>
    </section>
  </main>

  <script>
    // Elements
    const form = document.getElementById('supportForm');
    const msg = document.getElementById('formMsg');
    const btn = document.getElementById('submitBtn');
    const user = document.getElementById('username');
    const email = document.getElementById('email');
    const category = document.getElementById('category');
    const subjectEl = document.getElementById('subject');
    const details = document.getElementById('details');
    const fileInput = document.getElementById('file');
    const consent = document.getElementById('consent');

    // Prefill username from login (bobrix_username)
    try {
      const last = localStorage.getItem('bobrix_username');
      if (last) user.value = last;
    } catch(_) {}

    // Enable/disable submit
    function updateSubmitState(){
      const ready =
        user.value.trim().length >= 3 &&
        category.value.trim().length > 0 &&
        subjectEl.value.trim().length >= 4 &&
        details.value.trim().length >= 20 &&
        consent.checked;
      btn.disabled = !ready;
    }
    user.addEventListener('input', updateSubmitState);
    email.addEventListener('input', updateSubmitState);
    category.addEventListener('change', updateSubmitState);
    subjectEl.addEventListener('input', updateSubmitState);
    details.addEventListener('input', updateSubmitState);
    consent.addEventListener('change', updateSubmitState);
    updateSubmitState();

    function setMessage(type, text){
      msg.className = 'msg ' + type;
      msg.textContent = text;
      msg.style.display = 'block';
    }

    // Read file as base64 (if any)
    function readFileBase64(file){
      return new Promise((resolve,reject)=>{
        const r = new FileReader();
        r.onload = () => resolve(String(r.result).split(',').pop()); // strip data: prefix
        r.onerror = () => reject(new Error('Failed to read file'));
        r.readAsDataURL(file);
      });
    }

    function makeTicketId(){
      const t = new Date();
      return 'BRX-' + t.toISOString().replace(/[-:.TZ]/g,'').slice(0,14) + '-' + Math.floor(Math.random()*1e4).toString().padStart(4,'0');
    }

    async function buildPayload(){
      let attachment = null;
      if (fileInput.files && fileInput.files[0]) {
        const f = fileInput.files[0];
        const base64 = await readFileBase64(f);
        attachment = {
          filename: f.name,
          type: f.type || 'application/octet-stream',
          size: f.size,
          base64
        };
      }
      return {
        ticketId: makeTicketId(),
        username: user.value.trim(),
        email: email.value.trim() || null,
        category: category.value,
        subject: subjectEl.value.trim(),
        details: details.value.trim(),
        attachment,
        meta: {
          userAgent: navigator.userAgent,
          language: navigator.language,
          platform: navigator.platform,
          submittedAt: new Date().toISOString()
        }
      };
    }

    async function submitToPrimary(payload){
      // Primary (recommended): your backend support endpoint
      const res = await fetch('https://internal.api.bobrix.ca/support/submit', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        // If you later want cookies/sessions: credentials: 'include',
        body: JSON.stringify(payload)
      });
      if (!res.ok) throw new Error('Primary endpoint failed');
      return res.text();
    }

    function saveLocalFallback(payload){
      try {
        const key = 'bobrix_support_drafts';
        const drafts = JSON.parse(localStorage.getItem(key) || '[]');
        drafts.unshift(payload);
        localStorage.setItem(key, JSON.stringify(drafts.slice(0,50))); // keep last 50
      } catch(_) {}
    }

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      msg.style.display = 'none';

      if (btn.disabled) return;

      btn.disabled = true;
      btn.textContent = 'Sending…';

      try{
        const payload = await buildPayload();
        try{
          await submitToPrimary(payload);
          setMessage('success', `Thanks! Your ticket (${payload.ticketId}) was sent to Support.`);
        } catch(err){
          // Fallback: store locally so the user doesn't lose what they typed
          saveLocalFallback(payload);
          setMessage('success', `We saved your request locally as ${payload.ticketId}. We’ll submit it once Support is live.`);
        }

        // Reset form (keep username)
        const keepUser = user.value;
        form.reset();
        user.value = keepUser;
        updateSubmitState();
      } catch(err){
        setMessage('error', 'Could not send your request. Please try again.');
      } finally{
        btn.textContent = 'Send to Support';
        updateSubmitState();
      }
    });
  </script>
</body>
</html>
